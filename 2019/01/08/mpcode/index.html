<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>小程序码 | 点滴</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="写在前边： 最近在看很火的小微信程序，使用微信扫描打开，在我们一般认识中，扫描一般是商品条形码、二维码？这种是什么码？叫什么名字呢？  问了群了，尽然也没人了解，看到过，就是不知道名字。尝试使用支付宝、淘宝扫描，没反应，说明识别不了。当前微信是可以扫描的，但我行知道扫描的结果，当好在写微信小程序学习demo，介入扫描功能，打印 1234567&amp;#123;    &amp;quot;result&amp;quot;">
<meta property="og:type" content="article">
<meta property="og:title" content="小程序码">
<meta property="og:url" content="https://kangning1206.github.io/2019/01/08/mpcode/index.html">
<meta property="og:site_name" content="点滴">
<meta property="og:description" content="写在前边： 最近在看很火的小微信程序，使用微信扫描打开，在我们一般认识中，扫描一般是商品条形码、二维码？这种是什么码？叫什么名字呢？  问了群了，尽然也没人了解，看到过，就是不知道名字。尝试使用支付宝、淘宝扫描，没反应，说明识别不了。当前微信是可以扫描的，但我行知道扫描的结果，当好在写微信小程序学习demo，介入扫描功能，打印 1234567&amp;#123;    &amp;quot;result&amp;quot;">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://kangning1206.github.io/img/Snip20190107_1.png">
<meta property="og:image" content="https://kangning1206.github.io/img/111702011_2_2017092305031369">
<meta property="og:image" content="https://kangning1206.github.io/img/111702011_3_20170923050313194.jpeg">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_5_20170923050313491">
<meta property="og:image" content="https://kangning1206.github.io/img/111702011_6_20170923050313694">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_7_20170923050313803">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_8_201709230503146">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_9_20170923050314194">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_10_20170923050314350">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_11_20170923050314428">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_12_20170923050314522">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_13_20170923050314584">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_14_20170923050314662">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_15_20170923050314772">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_16_20170923050314834">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_17_20170923050314944">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_18_20170923050315131">
<meta property="og:image" content="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_19_20170923050315225">
<meta property="og:updated_time" content="2019-01-08T04:01:48.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小程序码">
<meta name="twitter:description" content="写在前边： 最近在看很火的小微信程序，使用微信扫描打开，在我们一般认识中，扫描一般是商品条形码、二维码？这种是什么码？叫什么名字呢？  问了群了，尽然也没人了解，看到过，就是不知道名字。尝试使用支付宝、淘宝扫描，没反应，说明识别不了。当前微信是可以扫描的，但我行知道扫描的结果，当好在写微信小程序学习demo，介入扫描功能，打印 1234567&amp;#123;    &amp;quot;result&amp;quot;">
<meta name="twitter:image" content="https://kangning1206.github.io/img/Snip20190107_1.png">
  
  <link rel="stylesheet" href="/css/index.css">
</head>
</html>
<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">kangning1206</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://github.com/kangning1206" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">小程序码</h2>
  <p class="sub">1月 8, 2019</p>
  <article class="content">
    <p>写在前边：</p>
<p>最近在看很火的小微信程序，使用微信扫描打开，在我们一般认识中，扫描一般是商品条形码、二维码？这种是什么码？叫什么名字呢？</p>
<p><img src="/img/Snip20190107_1.png" alt="小程序码"></p>
<p>问了群了，尽然也没人了解，看到过，就是不知道名字。尝试使用支付宝、淘宝扫描，没反应，说明识别不了。<br>当前微信是可以扫描的，但我行知道扫描的结果，当好在写微信小程序学习demo，介入扫描功能，打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;result&quot;: &quot;&quot;,</span><br><span class="line">    &quot;charSet&quot;: &quot;UTF-8&quot;,</span><br><span class="line">    &quot;errMsg&quot;: &quot;scanCode:ok&quot;,</span><br><span class="line">    &quot;scanType&quot;: &quot;WX_CODE&quot;,</span><br><span class="line">    &quot;rawData&quot;: &quot;azE7L356YU8rWi5MNGVAbU89QlpuNg==&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>scanType等于WX_CODE，如果是二维码是QR_CODE; 和明显是微信使用的特例，恰好第二天看到如下文章，原来可以称 <code>小程序码</code></p>
<blockquote>
<p>以下文章来源于：<a href="http://www.360doc.com/content/17/0923/17/32606862_689475945.shtml" target="_blank" rel="noopener">http://www.360doc.com/content/17/0923/17/32606862_689475945.shtml</a></p>
</blockquote>
<table style="width: 656px;"><br><tbody><br><tr><br><td id="artContent" style="max-width: 656px"><br><div style="width: 656px; margin: 0; padding: 0; height: 0;"></div><br><p><inherit><strong><span>小程序码的出现</span></strong><br></inherit></p><p><span>2017年1月9号</span><span>，微信正式发布小程序，最开始只能通过微信【</span><span>扫一扫】</span><span>识别进入特定小程序。</span><span>4月14</span><span>号，正式开放了【</span><span>长按识别二维码】</span><span>的功能，这</span><span>意味着，</span><span>用户使用小程序的便捷程度将大大提高。</span></p><p><inherit><br></inherit></p><p><span>此后，</span><span>仅仅过了4</span><span>天，微信又</span><span>推出了小程序码，支持【</span><span>扫一扫】</span><span>和【</span><span>长按识别扫码】</span><span>。</span></p><p></p><p><span>小程序码虽然长得跟二维码截然不同，但二维码所有的功能，小程序码同样具备。</span></p><p><span>为什么微信要推出这样的异形二维码？小程序码背后又</span><span>有何故事？</span></p><p><span>别着急，今天就来给大家讲讲小程序码背后的故事。</span></p><p><span><br></span></p><p><inherit><span><span>二维码 VS 小程序码</span></span></inherit></p><p><span>第一次扫小程序码的时候，</span><span>其实是抱着试一试的心态来的。</span></p><p><inherit><br></inherit></p><p><span>当时就在想，这么不像二维码的码真的能扫出来？结果一试还真可以！后面通过查找资料才发现，原来这种异形二维码并不是微信的首创，Facebook、Snap 等公司都已经推出过类似的异形码：</span></p><p><img data-s="300,640" data-type="png" data-ratio="0.37986577181208053" data-w="745" src="/img/111702011_2_2017092305031369"></p><p><span><span>下面这个二维码</span><span>通过图像处理和识别技术</span><span>把</span><span>传统二维码中近70%的色块抹掉，做成一种近乎无形的二维码。它是</span><span>以色列一家创业公司（Visualead）的作品。</span></span></p><p><span></span></p><p><img data-s="300,640" data-type="png" data-ratio="1" data-w="684" src="/img/111702011_3_20170923050313194.jpeg"></p><p><span><span></span><span>（可通过淘宝 APP 扫码识别）</span></span></p><p><span><span><br></span></span></p><p><span>阿里巴巴于2015年投资了这家公司，在</span><span>旗下的网站、</span><span>APP</span><span>&nbsp;以及云计算等产品中已经开始使用 相关技术。</span></p><p></p><p><span>动态视觉码</span></p><p><span><br></span></p><p><span>此外还有很多充满想象力的「变脸二维码」（作者：笑脸兔）：</span></p><p><span></span></p><p><img data-s="300,640" data-type="png" data-ratio="1.0608" data-w="625" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_5_20170923050313491"></p><p><span></span><br></p><p><span></span></p><p><span>面对市面上这么多好玩又有趣的二维码，微信推出专属的小程序码，</span><span>既意</span><span>料</span><span>之外，又情理之中。</span></p><p><span>如果上面的理由还没有说服到你，我们再从二维码和小程序码对比的角度，来看看小程序码有什么优点。</span></p><p><span>传统二维码往往以有下几个缺点：</span></p><ul><li><p><span>扫码预期：每张二维码的背后可能代表一个文件，一个页面、又或者是一个应用</span></p></li></ul><ul><li><p><span>安全性：二维码由于其开放性，很容易成为木马病毒的温床，很多人会担心扫码之后可能使自己的手机感染病毒而放弃扫码</span></p></li></ul><ul><li><p><span>品牌宣传：无法满足小程序的品牌宣传需求</span></p></li></ul><p><span>小程序码的优点：</span></p><ul><li><p><span>观赏性：小程序码与普通二维码相比，看起来更美观</span></p></li></ul><ul><li><p><span>扫码预期：扫码前能明确知道扫码之后将会体验到一个小程序</span></p></li></ul><ul><li><p><span>安全性：小程序码目前只能通过微信产生，并且只能通过微信识别，安全性更高</span></p></li></ul><ul><li><p><span>品牌宣传：每个小程序码右下角都是固定的微信小程序 Logo，每见到一次小程序码，大家就能多一次联想到微信小程序</span></p></li></ul><ul><li><p><span>高容错性：当一张二维码图片中间嵌有某些 Logo 图片时，其实相当于是把最中间部分有用的编码信息挖掉，再贴一张 Logo 图片上去。而小程序码不同，中间的 Logo 区并不包含数据编码的部分，因此小程序码拥有更高的容错性</span></p></li></ul><p><inherit><br></inherit></p><p><span>很明显，小程序码是更好的选择：）</span></p><p><span><br></span></p><p><inherit><strong><span>小程序码的绽放过程</span></strong></inherit></p><p><span>这是小程序码最初的设计稿雏形，可以看到的确是一朵花的形状，稍有不同的是这个雏形图中只有两个定位点。</span></p><p><inherit><br></inherit></p><p><span>而目前我们看到的小程序码，</span><span>一共有3个定位点。</span></p><p><span><br></span></p><p><img data-s="300,640" data-type="png" data-ratio="1.0910891089108912" data-w="505" src="/img/111702011_6_20170923050313694"></p><p><span>这个是小程序码的规范设计稿：</span></p><p><span></span></p><p><img data-s="300,640" data-type="png" data-ratio="0.9902597402597403" data-w="616" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_7_20170923050313803"></p><p><span>目前小程序码一共支持 3 种容量，分别是 36 射线、54 射线和 72 射线。</span></p><p><span></span></p><p><img data-s="300,640" data-type="png" data-ratio="0.3312883435582822" data-w="652" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_8_201709230503146"></p><p><span>每个版本分别对应 L、M、Q、H 4种容错级别：</span></p><ul><li><p><span>L 级容错的小程序码，大约 10% 的字码可被修正</span></p></li></ul><ul><li><p><span>M 级容错的小程序码，大约 15% 的字码可被修正</span></p></li></ul><ul><li><p><span>Q 级容错的小程序码，大约 25% 的字码可被修正</span></p></li></ul><ul><li><p><span>H 级容错的小程序码，大约 35% 的字码可被修正</span></p></li></ul><p><span>这应该如何理解呢？</span></p><p><inherit><br></inherit></p><p><span>例如 H 级容错的小程序码，大约 35 %的字码可被修正</span><span>。这</span><span>意味着在最理想情况下，当这个小程序码 35% 的面积被遮挡/损坏，扫码引擎还是能识别出这个小程序码承载的信息。</span></p><p><inherit><br></inherit></p><p><span>但是，</span><span>这 35% 被破坏的面积，不能是定位图案和功能性数据，必须是纯编码区，而且错误的区域还要分布得刚刚好，条件是非常苛刻的。</span></p><p><inherit><br></inherit></p><p><span>所以，</span><span>这里的百分数是一个非常理想的数据，实际测试的结果会比这个百分数稍微低一些。</span></p><p><span>不过现阶段</span><span>，</span><span>当我们通过官方 API 文档去请求一张小程序码图片时，暂时不用（或者说未能）指定期望生成的是哪种版本、哪个容错级别的小程序码，这些是微信后台会帮开发者自动选择的。</span></p><p><span>麻雀虽小，五脏俱全。</span></p><p><inherit><br></inherit></p><p><span>小程序码有两个 Logo 区域，分别是中间的自定义 Logo 区和右下角的官方 Logo 区，灰色的区域是小程序码的数据编码区，其它彩色区域是小程序码的功能性数据（主要包括版本、纠错等信息。</span></p><p><inherit><br></inherit></p><p><span>至于具体如何对应，由于微信官方暂时尚未对外公开，所以这里也要先保密一下哦）</span></p><p><span></span></p><p><img data-s="300,640" data-type="png" data-ratio="0.47197309417040356" data-w="892" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_9_20170923050314194"></p><p><span></span></p><p><img data-s="300,640" data-type="png" data-ratio="0.18227848101265823" data-w="790" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_10_20170923050314350"></p><p><span>小程序码这朵【</span><span>菊花】</span><span>是如织绽放的呢？主要要以下几个步骤：</span></p><p><span><br></span></p><p><inherit><strong><span>1.定位点</span></strong></inherit></p><p><span>首先确定 3 个定位点和右下角的官方&nbsp;</span><span>l</span><span>ogo 区，经过第一步小程序码的大小也随着确定。</span></p><p><img data-s="300,640" data-type="png" data-ratio="1.0144927536231885" data-w="276" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_11_20170923050314428"></p><p><span></span><br></p><p><inherit><strong><span>2.信息编码区</span></strong></inherit></p><p><span>编码的过程主要是把原始信息（例如某个小程序的首页）转化成计算机能识别的语言——二进制序列（例如 0110…110）的过程</span><span>。</span></p><p><inherit><br></inherit></p><p><span>听起来是不是有点抽象？你可以这么理解，六个月大的婴儿吃不了大米，但是我们可以把大米砸碎研磨变成米浆米糊，这样他就可以食用消化的，原理是差不多的，大而化小 :）</span></p><p><img data-s="300,640" data-type="png" data-ratio="0.12909441233140656" data-w="519" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_12_20170923050314522"></p><p><span>编码完的下一步是加纠错码。</span></p><p><inherit><br></inherit></p><p><span>这个过程有点复杂，这里我也尝试用大家能听懂的语言给大家解释一下。</span></p><p><inherit><br></inherit></p><p><span>假设桌子上先是放了 100 个生鸡蛋（代表上一步已经转换好的二进制序列），然后再加入120个熟鸡蛋（代表纠错码，具体个数就视纠错率而定了，这里只是一种假设）。表面上看起来生鸡蛋和熟鸡蛋并没有太大的区别，但是其实还是有办法能辨别出来的。</span><span>例如，</span><span>生鸡蛋由于蛋黄悬浮到鸡蛋中间，重心不稳，无法旋转，而熟鸡蛋是可以旋转的。</span></p><p><inherit><br></inherit></p><p><span>经过纠错码这个步骤，数据量变大了（从生熟鸡蛋的例子来看，桌子上的鸡蛋由 100 个变为 220 个），而回到我们上一个步骤，相当于把二进制序列 0110…110</span><span>&nbsp;进行了扩展（假设原来 0 和 1 加起来一共有 170 位，经过纠错编码之后就变成了一共 400 位的 1010…101）。</span></p><p><img data-s="300,640" data-type="png" data-ratio="0.08957219251336898" data-w="748" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_13_20170923050314584"></p><p><span>这里需要补充说明的一点是，</span><span>加纠错码这个阶段不只是让数据量简单地增大。</span></p><p><inherit><br></inherit></p><p><span>一旦小程序码的版本、纠错级别确定了，其对应的纠错码都是固定的了，这样解码阶段才能通过对应的规则去消除纠错码，把真正有用的数据保留下来（回到生熟鸡蛋的例子就是只留下生鸡蛋，而把熟鸡蛋排除掉）。</span></p><p><span>经过信息转换和纠错编码之后，我们得到一串最终的二维码序列，就可以把信息按一定的编码顺序填充到小程序码的编码区域（1对应的是黑色，0对应的是白色）。</span></p><p><inherit><br></inherit></p><p><span>填充之后我们发现小程序上花瓣看起来很不均匀，比如下图</span><span>：</span></p><p><img data-s="300,640" data-type="png" data-ratio="0.385989010989011" data-w="728" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_14_20170923050314662"></p><p><span>所以为了让小程序码的花瓣看起来更加均衡，需要再多做一步操作。</span></p><p><inherit><span>——分隔线开始——</span></inherit></p><p><inherit><br></inherit></p><p><span>在此之前，我们先来学习一下逻辑异或（XOR，符号是⊕ ）的基本知识，请看下面这个表格。</span></p><p><img data-s="300,640" data-type="png" data-ratio="0.7674418604651163" data-w="215" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_15_20170923050314772"></p><p><span>A ⊕ B ，当 AB 不等时值为1，AB 相等时值为0。A和同一个 B 经过两次异或操作，结果跟原码相同（A ⊕&nbsp; B ⊕&nbsp; B = A）。</span></p><p><span></span></p><p><img data-s="300,640" data-type="png" data-ratio="0.6271929824561403" data-w="456" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_16_20170923050314834"></p><p><inherit><span>——分隔线结束——</span></inherit><inherit><span><br></span></inherit></p><p><inherit><strong><span>3.掩码操作</span></strong></inherit></p><p><span>将小程序码跟</span><span>32</span><span>种掩膜（又称【</span><span>mask】</span><span>，可依照一定的规则生成）进行异或运算，最终选取效果最佳的作为最终的小程序码。</span></p><p><span></span><br></p><p><img data-s="300,640" data-type="png" data-ratio="0.9020618556701031" data-w="582" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_17_20170923050314944"></p><p><inherit><strong><span><br></span></strong></inherit><inherit><strong><span>4.功能性数据</span></strong></inherit></p><p><span>最后一步是填充功能性数据，最终效果如下：</span></p><p><img data-s="300,640" data-type="png" data-ratio="0.9316239316239316" data-w="234" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_18_20170923050315131"></p><p><span>至此，小程序码就完成了它的绽放过程 :）</span></p><p><br></p><p><inherit><strong><span>获取小程序码</span></strong></inherit></p><p><span>根据小程序官方开发文档的说明，目前请求生成一个小程序码有两个接口（A 和 B），请求生成小程序二维码有一个接口（C），这三个接口有什么区别呢？</span></p><ul><li><p><span>数量限制：</span><span>接口 A、C 生成的小程序码和二维码加起来不能超过 10w 个，接口 B 生成的小程序码则数量没有限制</span></p></li></ul><ul><li><p><span>时效性：接口 A、B、C 生成的小程序码/二维码永久有效</span></p></li></ul><ul><li><p><span>页面指定性：</span><span>接口 A、C 生成的小程序码/二维码可以直接进入指定页面，而接口 B 生成的小程序码需要通过技术开发处理逻辑（通过参数 scene）后才能跳转到其它页面</span></p></li></ul><p><span>建议大家优先使用 B 接口去生成二维码，一方面是小程序码始终是比二维码可辨认性高，另一方面没有数量限制，而且技术处理也相对简单。</span></p><p><span>关于小程序码的样式，现阶段我们主要可以定义以下方面的内容：</span></p><ul><li><p><span>小程序码的尺寸</span></p></li></ul><ul><li><p><span>小程序码的射线颜色</span></p></li></ul><ul><li><p><span>自定义 Logo 区的图片</span></p></li></ul><p><span>由于目前我们只能定义小程序码的射线颜色，无法定义整个小程序码图片的背景颜色。所以在声明小程序码射线的颜色这一步，主要有两种思路：</span></p><ul><li><p><span>通过设置 line_color 来决定小程序码射线的颜色，不过这个时候最好是确保射线跟背景色（白色）有一定的对比度，降低扫码成本</span></p></li></ul><ul><li><p><span>设置 auto_color 为 true（默认为 false），微信后台会智能根据中间 Logo区域的主色调来确定小程序码射线的颜色</span></p></li></ul><p><inherit><span>微信识别小程序码</span></inherit></p><p><span>小程序码识别过程跟小程序码的生成过程是反过来的，大家可以通过简单的流程图来感受一下。</span></p><p><span><br></span></p><p><img data-s="300,640" data-type="png" data-ratio="1.415289256198347" data-w="484" src="http://image109.360doc.com/DownloadImg/2017/09/2317/111702011_19_20170923050315225"></p><br></td><br></tr><br></tbody><br></table>

  </article>
  <footer class="f-cf">
    
    
      <a href="/2018/12/22/interview/" class="link f-fr">面试题⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  kangning1206@163.com
  
    
      
        · <a href="https://github.com/kangning1206" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>